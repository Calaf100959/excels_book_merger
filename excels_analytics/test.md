# テスト観点（Excel統合ツール）

このツール（`excel_merger_gui.py` + `merge_excel_sheets.ps1`）の機能テストを行うための観点メモです。

## 手動テスト（優先順）

### 1. 入力列挙

- フォルダ選択後に `*.xls/*.xlsx/*.xlsm/*.xlsb` が一覧に出る
- `~$` で始まる一時ファイルが一覧に出ない
- 対象0件のときに「統合開始」が無効になり、状態表示が適切

### 2. 選択統合（部分指定）

- 「選択したファイルのみ」OFF: 一覧の全ファイルが対象
- 「選択したファイルのみ」ON:
  - 未選択で「統合開始」→警告が出て開始されない
  - 複数選択で開始→選択したファイルのみが統合される

### 3. 同名シート名の扱い（連番付与）

- 同名シートが出た場合に `Sheet`, `Sheet_2`, `Sheet_3` … のように連番付与される
- 31文字超のシート名や禁止文字（`: \ / ? * [ ]`）を含むシート名でも破綻しない（置換・切り詰めが動く）

### 4. 形式混在

- 入力が `.xls` + `.xlsx` など混在しても統合できる
- 保存先として `.xlsx/.xlsm/.xls/.xlsb` を選んだときにそれぞれ保存できる

### 5. 例外系（開けないファイル）

- パスワード付き、破損、ロック中（他アプリで開いている）等を混ぜた場合:
  - `WARN` としてログに残り
  - 他のファイルの処理は継続する

### 6. キャンセル

- 処理途中に「キャンセル」を押すと中断される
- 中断後に `EXCEL.EXE` が残っていない（タスクマネージャで確認）

### 7. 保存

- 統合完了後に「名前を付けて保存」ダイアログが出る
- 保存をキャンセル→再試行する/中止するを選べる
- 存在しないフォルダを保存先に指定できない（エラー表示され再選択になる）

## 自動スモークテスト案（現実的な範囲）

Excelの内容比較まで自動化するのは重いので、まずは「落ちない・終了コードが期待通り・ログが出る」を狙うのが現実的です。

### 1. PowerShell スクリプト単体テスト

`merge_excel_sheets.ps1` は `-FileListPath` を渡して単体実行できるため、以下を確認するスモークを作れます。

- `FileListPath` が空 → `rc=1` で `LOG|対象ファイルがありません。` が出る
- 存在しない `FileListPath` → `rc=1` で `LOG|[ERROR] ...` が出る
- 正常なExcelファイル数件 → `rc=0` で保存まで完了する
- キャンセルフラグを途中で作成 → `rc=2` で中断する

### 2. GUI 経由のスモーク

GUIはユーザー操作が絡むため、まずは「起動できる」「一覧更新できる」「統合開始で処理が走る」までの確認を短手順で回すのが有効です。

